{"remainingRequest":"/home/stevenbustos/Downloads/SIUA/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/stevenbustos/Downloads/SIUA/frontend/src/components/requests/create/CreateRequestA.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/stevenbustos/Downloads/SIUA/frontend/src/components/requests/create/CreateRequestA.vue","mtime":1548795586000},{"path":"/home/stevenbustos/Downloads/SIUA/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/stevenbustos/Downloads/SIUA/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/stevenbustos/Downloads/SIUA/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/stevenbustos/Downloads/SIUA/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Vue from 'vue';\nimport Multiselect from 'vue-multiselect'\nimport Vuex from 'vuex'\nimport {axios,verifyPermits,requestModulePermit,postModulePermit} from '../../../helpers/axios';\nimport { required } from 'vuelidate/lib/validators'\nimport CreatePerson from '../../persons/CreatePersonModal.vue'\nimport CreateClause from '../../clauses/CreateClauseModal.vue'\n\nvar API_IP = process.env.VUE_APP_API_IP\nconst { mapActions, mapState } = Vuex\n\nexport default {\n  props: ['stp'],\n  components: {\n    Multiselect,\n    'create-person': CreatePerson,\n    'create-clause': CreateClause\n  },\n  data () {\n    return {\n      types_request:[],\n      permitODS:[],\n      permitODC:[],\n      permitATI:[],\n      permitAll:[0,1,2,3,4],\n\n      personasInterventor:[],\n      personasContratista:[],\n      personasResponsable:[],\n\n\n      interventoresSelect:[],\n      contratistasSelect:[],\n      responsablesSelect:[],\n\n      interventor:\"\",\n      contratista:\"\",\n      responsable:\"\",\n\n      start_request_date:\"\",\n      end_request_date:\"\",\n      total_days:\"\",\n\n      causals:[],\n      clauses:[],\n\n\n      causal: \"\",\n      clausulas: \"\",\n      clausulas_request:[],\n      person_charge:\"\",\n      message:\"\",\n      tipo_solicitud:\"\",\n      trabajadores:[],\n      step: this.stp,\n      correct_date: false,\n      modal_show: false,\n      submitting: false\n    }\n  },\n  validations: {\n    tipo_solicitud:{required}, interventor:{required}, contratista:{required},\n    start_request_date:{required}, end_request_date:{required},\n    total_days:{required}, causal:{required}, responsable: {required}\n  },\n  watch:{\n    interventor:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n    contratista:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n    responsable:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n\n  },\n  methods:{\n\n    async loadDataMultiselects(){\n      this.permitODS=await verifyPermits(9,this.permitAll)\n      this.permitODC=await verifyPermits(10,this.permitAll)\n      this.permitATI=await verifyPermits(11,this.permitAll)\n\n      let causalsData=await requestModulePermit(200,0)\n      let clausesData=await requestModulePermit(6,0)\n      console.log(\"asdadsad\");\n      console.log(this.permitODS[2]);\n      console.log(this.permitODC[2]);\n      console.log(this.permitATI[2]);\n\n      if (!this.permitODS[2] && !this.permitODC[2] && !this.permitATI[2]) {\n        alert(\"no tiene permiso\")\n      }\n      else{\n        if (causalsData !== -1  && causalsData!== 0) {\n          this.causals = causalsData\n        }\n        if (clausesData !== -1 && clausesData !== 0) {\n          this.clauses = clausesData\n        }\n        let types_tmp=await requestModulePermit(205,0)\n        for (var k in types_tmp){\n          if(types_tmp[k].nombre == \"ODS\" && this.permitODS[2]){\n            this.types_request.push(types_tmp[k])\n          }\n          else if(types_tmp[k].nombre == \"ODC\" && this.permitODC[2]){\n            this.types_request.push(types_tmp[k])\n          }\n          else if(types_tmp[k].nombre == \"ATI\" && this.permitATI[2]){\n            this.types_request.push(types_tmp[k])\n          }\n        }\n        let allProfesores = await requestModulePermit(206,0,\"profesor\")\n        let allContratistas = await requestModulePermit(206,0,\"contratista\")\n        let allPlanta = await requestModulePermit(206,0,\"planta\")\n        for (var k in allProfesores){\n          var person = {}\n          person[\"_id\"] = allProfesores[k]._id;\n          person[\"name\"] = allProfesores[k].primer_nombre+\" \"+allProfesores[k].segundo_nombre+\" \"+allProfesores[k].primer_apellido+\" \"+allProfesores[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n        }\n        for (var k in allContratistas){\n          var person = {}\n          person[\"_id\"] = allContratistas[k]._id;\n          person[\"name\"] = allContratistas[k].primer_nombre+\" \"+allContratistas[k].segundo_nombre+\" \"+allContratistas[k].primer_apellido+\" \"+allContratistas[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n          this.contratistasSelect.push(person);\n        }\n        for (var k in allPlanta){\n          var person = {}\n          person[\"_id\"] = allPlanta[k]._id;\n          person[\"name\"] = allPlanta[k].primer_nombre+\" \"+allPlanta[k].segundo_nombre+\" \"+allPlanta[k].primer_apellido+\" \"+allPlanta[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n        }\n        this.personasInterventor = this.interventoresSelect\n        this.personasContratista = this.contratistasSelect\n        this.personasResponsable = this.responsablesSelect\n      }\n    },\n\n    changeEndRequestDate(){\n      var sd=new Date(this.start_request_date);\n      var ed=new Date(this.end_request_date);\n      if (sd > ed) {\n        this.correct_date = true\n        this.total_days=0;\n      } else {\n        this.correct_date = false\n        sd.setDate(sd.getDate()+1)\n        ed.setDate(ed.getDate()+1)\n        var differentDays = Math.ceil(Math.abs( ed.getTime() - sd.getTime()) / (1000 * 3600 * 24));\n        this.total_days=differentDays+1;\n      }\n    },\n    cancel(){\n      this.$v.$reset()\n      this.$swal({\n        title: 'Espere',\n        text: '¿Esta seguro que quiere cancelar la operación?',\n        type: 'warning',\n        showCancelButton: true,\n        confirmButtonText: 'Si',\n        cancelButtonText: 'No',\n      }).then((result) => {\n        if (result.value) {\n          this.$swal({\n            title: 'Cancelado',\n            type: 'success'\n          }).then((result) => {\n            if (result.value) {\n              this.$router.push({ name: 'requests' });\n            }\n          });\n        }\n      });\n    },\n    async saveContinue(){\n      this.$v.$touch()\n      if (this.$v.$invalid) {\n        this.$swal({\n          title: 'Error!',\n          text: 'Debe llenar campos necesarios en el formulario',\n          type: 'error',\n          confirmButtonText: 'Cerrar'\n        });\n      } else {\n        this.submitting = true\n        for(var k in this.clausulas){\n          this.clausulas_request.push(this.clausulas[k]._id)\n        }\n\n        let data = {\n          numero_solicitud: \"\",\n          tipo_solicitud:this.tipo_solicitud._id,\n          fecha_inicio:this.start_request_date,\n          fecha_final: this.end_request_date,\n          valor_solicitud:0,\n          justificacion:\"\",\n          justificacion_adicional:\"\",\n          causal_seleccion:this.causal._id,\n          objetivo_general:\"\",\n          clausulas:this.clausulas_request,\n          especificaciones_tecnicas:[],\n          obligaciones_especificas:[],\n          rubros:[],\n          trabajadores:[{persona:this.contratista._id,tipo:\"Contratista\"},{persona:this.interventor._id,tipo:\"Interventor\"},{persona:this.responsable._id,tipo:\"Responsable\"}]\n        }\n\n        let res;\n\n        if (this.tipo_solicitud.nombre == \"ODS\" && this.permitODS[2]) {\n          res=await postModulePermit(9,2,data)\n        }\n        else if (this.tipo_solicitud.nombre == \"ODC\" && this.permitODC[2]) {\n          res=await postModulePermit(10,2,data)\n        }\n        else if (this.tipo_solicitud.nombre == \"ATI\" && this.permitATI[2]) {\n          res=await postModulePermit(11,2,data)\n        }\n\n        if (res != undefined && res != null){\n          if (res.res) {console.log(res.res.obj.data);\n            this.$swal({\n              title: 'Exito!',\n              text: 'Se creo la solicitud con exito.',\n              type: 'success',\n              confirmButtonText: 'Aceptar'\n            }).then((result) => {\n              if (result.value) {\n                this.$emit('saveObject',res);\n                this.submitting = false;\n                this.step++\n                this.$emit('nextStep', this.step)\n              }\n            });\n          }\n          else if (res.error) {\n            this.$swal({\n               title: 'Error!',\n               text: res.error.error.msg,\n               type: 'error',\n               confirmButtonText: 'Cerrar'\n             });\n             this.submitting = false;\n          }\n        }\n\n      }\n    },\n\n    // saveContinue(){\n    //   this.$v.$touch()\n    //   if (this.$v.$invalid) {\n    //     this.$swal({\n    //       title: 'Error!',\n    //       text: 'Debe llenar campos necesarios en el formulario',\n    //       type: 'error',\n    //       confirmButtonText: 'Cerrar'\n    //     });\n    //   } else {\n    //     this.submitting = true\n    //     for(var k in this.clausulas){\n    //       this.clausulas_request.push(this.clausulas[k]._id)\n    //     }\n    //     axios\n    //     .post(API_IP+\"/request\", {\n    //       numero_solicitud: \"\",\n    //       tipo_solicitud:this.tipo_solicitud._id,\n    //       fecha_inicio:this.start_request_date,\n    //       fecha_final: this.end_request_date,\n    //       valor_solicitud:0,\n    //       justificacion:\"\",\n    //       justificacion_adicional:\"\",\n    //       causal_seleccion:this.causal._id,\n    //       objetivo_general:\"\",\n    //       clausulas:this.clausulas_request,\n    //       especificaciones_tecnicas:[],\n    //       obligaciones_especificas:[],\n    //       rubros:[],\n    //       trabajadores:[{persona:this.contratista._id,tipo:\"Contratista\"},{persona:this.interventor._id,tipo:\"Interventor\"},{persona:this.person_charge._id,tipo:\"Responsable\"}]\n    //     })\n    //     .then(response => {\n    //       console.log(response);\n    //       this.$swal({\n    //         title: 'Exito!',\n    //         text: 'Se creo la solicitud con exito.',\n    //         type: 'success',\n    //         confirmButtonText: 'Aceptar'\n    //       }).then((result) => {\n    //         if (result.value) {\n    //           this.$emit('saveObject',response.data);\n    //           this.submitting = false;\n    //           this.step++\n    //           this.$emit('nextStep', this.step)\n    //         }\n    //       });\n    //     })\n    //     .catch(error => {\n    //       console.log(error);\n    //       this.$swal({\n    //         title: 'Error!',\n    //         text: error.response.data.error.msg,\n    //         type: 'error',\n    //         confirmButtonText: 'Cerrar'\n    //       });\n    //       this.submitting = false;\n    //     });\n    //   }\n    // },\n    // // Modal para la creación de personas\n    showModalCreatePerson () {\n      this.modal_show = false;\n      this.$modal.show('create-person');\n    },\n    closeModalCreatePerson (value) {\n      this.modal_show = value;\n      if(this.modal_show === true){\n        this.$modal.hide('create-person');\n        location.reload();\n      }\n    },\n    showModalCreateClause () {\n      this.modal_show = false;\n      this.$modal.show('create-clause');\n    },\n    closeModalCreateClause (value) {\n      this.modal_show = value;\n      if(this.modal_show === true){\n        this.$modal.hide('create-clause');\n        location.reload();\n      }\n    }\n  },\n  mounted(){\n    this.loadDataMultiselects()\n  }\n}\n",{"version":3,"sources":["CreateRequestA.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0LA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreateRequestA.vue","sourceRoot":"src/components/requests/create","sourcesContent":["<template>\n  <div>\n    <div class=\"row\">\n      <div class=\"col-md-8 offset-md-2\" style=\"margin-bottom:50px;\">\n        <div class=\"row\">\n          <div class=\"col\">\n            <button class=\"btn btn-primary\" type=\"button\" @click=\"cancel()\" style=\"background:#003e1e;border-color:#003e1e;\">\n              <font-awesome-icon icon=\"arrow-left\" size=\"lg\"></font-awesome-icon>\n            </button>\n          </div>\n        </div>\n        <div>&nbsp;</div>\n        <modal name=\"create-person\" :adaptive=\"true\" :scrollable=\"true\" width=\"50%\" height=\"auto\">\n          <create-person\n          :hide_modal=\"modal_show\"\n          @modalShow=\"closeModalCreatePerson\"\n          ></create-person>\n        </modal>\n        <modal name=\"create-clause\" :adaptive=\"true\" :scrollable=\"true\" width=\"50%\" height=\"auto\">\n          <create-clause\n          :hide_modal=\"modal_show\"\n          @modalShow=\"closeModalCreateClause\"\n          ></create-clause>\n        </modal>\n        <div class=\"row justify-content-center\">\n          <div class=\"col-10 align-self-center\">\n            <form v-on:submit.prevent=\"saveContinue\">\n              <div class=\"form-group\" :class=\"{ 'form-group--error': $v.tipo_solicitud.$error }\">\n                <div class=\"row\">\n                  <div class=\"col\">\n                    <label for=\"interventors\">Seleccione tipo de solicitud:</label>\n                  </div>\n                  <div class=\"col-6\">\n                    <multiselect id=\"box1\" v-model.trim=\"$v.tipo_solicitud.$model\" :options=\"types_request\" track-by=\"_id\" label=\"nombre\" :searchable=\"false\" :close-on-select=\"true\" :show-labels=\"true\" placeholder=\"Escoja un tipo de solicitud\">\n                    </multiselect>\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.tipo_solicitud.$dirty && !$v.tipo_solicitud.required\">Es requerido un tipo de solicitud</div>\n\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-group\" :class=\"{ 'form-group--error': $v.interventor.$error }\">\n                <div class=\"row\">\n                  <div class=\"col\">\n                    <label for=\"interventors\">Seleccione interventor:</label>\n                  </div>\n                  <div class=\"col-6\">\n                    <multiselect id=\"box1\" v-model.trim=\"$v.interventor.$model\" :options=\"personasInterventor\" track-by=\"_id\" label=\"name\" :searchable=\"false\" :close-on-select=\"true\" :show-labels=\"true\" placeholder=\"Escoja un interventor\">\n                    </multiselect>\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.interventor.$dirty && !$v.interventor.required\">Es requerido un interventor</div>\n                  </div>\n                  <div class=\"col\">\n                    <button class=\"btn btn-primary\" type=\"button\" @click=\"showModalCreatePerson()\" style=\"background:#003e1e;border-color:#003e1e;\">\n                      <font-awesome-icon icon=\"pencil-alt\" size=\"lg\"></font-awesome-icon>\n                      Crear Nuevo\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-group\" :class=\"{ 'form-group--error': $v.contratista.$error }\">\n                <div class=\"row\">\n                  <div class=\"col\">\n                    <label for=\"contratistas\">Seleccione contratista:</label>\n                  </div>\n                  <div class=\"col-6\">\n                    <multiselect id=\"box2\" v-model.trim=\"$v.contratista.$model\" :options=\"personasContratista\" track-by=\"name\" label=\"name\" :searchable=\"false\" :close-on-select=\"true\" :show-labels=\"true\" placeholder=\"Escoja un contratista\">\n                    </multiselect>\n\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.contratista.$dirty && !$v.contratista.required\">Es requerido un contratista</div>\n                  </div>\n                  <div class=\"col\">\n                    <button class=\"btn btn-primary\" type=\"button\" @click=\"showModalCreatePerson()\" style=\"background:#003e1e;border-color:#003e1e;\">\n                      <font-awesome-icon icon=\"pencil-alt\" size=\"lg\"></font-awesome-icon>\n                      Crear Nuevo\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <h3 style=\"color:#003e1e\"> Plazo </h3>\n              <div>&nbsp;</div>\n              <div class=\"row\">\n                <div class=\"col\">\n                  <label for=\"startDate\">Fecha inicio:</label>\n                </div>\n                <div class=\"col-4\">\n                  <div class=\"form-group\" :class=\"{ 'form-group--error': $v.start_request_date.$error }\">\n                    <input type=\"date\" v-model.trim=\"$v.start_request_date.$model\" class=\"form-control\" id=\"startDate\" aria-describedby=\"startDate\" @input=\"changeEndRequestDate\">\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.start_request_date.$dirty && !$v.start_request_date.required\">Es requerida una fecha de inicio</div>\n                  </div>\n                </div>\n                <div class=\"col\">\n                  <label for=\"endDate\">Fecha final:</label>\n                </div>\n                <div class=\"col-4\">\n                  <div class=\"form-group\" :class=\"{ 'form-group--error': $v.end_request_date.$error }\">\n                    <input type=\"date\" v-model.trim=\"$v.end_request_date.$model\" class=\"form-control\" id=\"endDate\" aria-describedby=\"endDate\" @input=\"changeEndRequestDate\">\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.end_request_date.$dirty && !$v.end_request_date.required\">Es requerida una fecha final</div>\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"correct_date\">La fecha final no puede ser menor a la fecha de inicio</div>\n                  </div>\n                </div>\n              </div>\n              <div>&nbsp;</div>\n              <div class=\"form-group\" :class=\"{ 'form-group--error': $v.total_days.$error }\">\n                <div class=\"row justify-content-center\">\n                  <div class=\"col-auto\">\n                    <label for=\"totalDays\">Total en dias:</label>\n                  </div>\n                  <div class=\"col-5\">\n                    <input type=\"text\" v-model.trim=\"$v.total_days.$model\" class=\"form-control\" id=\"totalDays\" aria-describedby=\"totalDays\" placeholder=\"Total\" disabled>\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.total_days.$dirty && !$v.total_days.required\">Es requerido un total de dias</div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-group\" :class=\"{ 'form-group--error': $v.causal.$error }\">\n                <div class=\"row justify-content-center\">\n                  <div class=\"col-auto\">\n                    <label for=\"selectionCausal\">Causal de selección:</label>\n                  </div>\n                  <div class=\"col-6\">\n                    <multiselect v-model.trim=\"$v.causal.$model\" :options=\"causals\" track-by=\"_id\" label=\"nombre\" :searchable=\"false\" :close-on-select=\"true\" :show-labels=\"true\" placeholder=\"Causal\">\n                    </multiselect>\n                    <div class=\"alert alert-danger\" role=\"alert\" v-if=\"$v.causal.$dirty && !$v.causal.required\">Es requerido un causal de selección</div>\n                  </div>\n                </div>\n              </div>\n\n              <h3 style=\"color:#003e1e\"> Clausulas adicionales (marcar) </h3>\n              <div>&nbsp;</div>\n              <div class=\"row justify-content-center\">\n                <div class=\"col-6\">\n                  <div class=\"form-group\">\n                    <multiselect v-model=\"clausulas\" :options=\"clauses\" :multiple=\"true\" :close-on-select=\"true\" :clear-on-select=\"false\" :hide-selected=\"true\" :preserve-search=\"true\" placeholder=\"Escoja las clausulas\" label=\"nombre\" track-by=\"_id\" :preselect-first=\"false\">\n                    </multiselect>\n                  </div>\n                </div>\n                <div class=\"col-auto\">\n                  <button class=\"btn btn-primary\" type=\"button\" @click=\"showModalCreateClause()\" style=\"background:#003e1e;border-color:#003e1e;\">\n                    <font-awesome-icon icon=\"plus\" size=\"lg\"></font-awesome-icon>\n                    Adicionar otras\n                  </button>\n                </div>\n              </div>\n              <div>&nbsp;</div>\n              <h3 style=\"color:#003e1e; text-align:center;\"> Si tiene clausula de responsabilidad de bienes por favor seleccione el responsable de los bienes </h3>\n              <div>&nbsp;</div>\n              <div class=\"form-group\" >\n                <div class=\"row\">\n                  <div class=\"col\">\n                    <label for=\"interventors\">Personas a cargo:</label>\n                  </div>\n                  <div class=\"col-6\">\n                      <multiselect v-model=\"responsable\" :options=\"personasResponsable\" track-by=\"_id\" label=\"name\" :searchable=\"false\" :close-on-select=\"true\" :show-labels=\"true\" placeholder=\"Escoja un interventor\">\n                    </multiselect>\n                  </div>\n                  <div class=\"col\">\n                    <button class=\"btn btn-primary\" type=\"button\" @click=\"showModalCreatePerson()\" style=\"background:#003e1e;border-color:#003e1e;\">\n                      <font-awesome-icon icon=\"pencil-alt\" size=\"lg\"></font-awesome-icon>\n                      Crear Nuevo\n                    </button>\n                  </div>\n                </div>\n              </div>\n              <div>&nbsp;</div>\n              <div class=\"row justify-content-center\">\n                <div class=\"col-3 text-center\">\n                  <button class=\"btn btn-primary\" type=\"submit\" :disabled=\"correct_date || submitting\" style=\"background:#003e1e;border-color:#003e1e;\">\n                    <font-awesome-icon icon=\"save\" size=\"lg\"></font-awesome-icon>\n                    Guardar y continuar\n                  </button>\n                </div>\n                <div class=\"col-3 text-center\">\n                  <button class=\"btn btn-primary\" type=\"button\" @click=\"cancel()\" style=\"background:#003e1e;border-color:#003e1e;\">\n                    <font-awesome-icon icon=\"times-circle\" size=\"lg\"></font-awesome-icon>\n                    Cancelar\n                  </button>\n                </div>\n              </div>\n            </form>\n            <br>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue';\nimport Multiselect from 'vue-multiselect'\nimport Vuex from 'vuex'\nimport {axios,verifyPermits,requestModulePermit,postModulePermit} from '../../../helpers/axios';\nimport { required } from 'vuelidate/lib/validators'\nimport CreatePerson from '../../persons/CreatePersonModal.vue'\nimport CreateClause from '../../clauses/CreateClauseModal.vue'\n\nvar API_IP = process.env.VUE_APP_API_IP\nconst { mapActions, mapState } = Vuex\n\nexport default {\n  props: ['stp'],\n  components: {\n    Multiselect,\n    'create-person': CreatePerson,\n    'create-clause': CreateClause\n  },\n  data () {\n    return {\n      types_request:[],\n      permitODS:[],\n      permitODC:[],\n      permitATI:[],\n      permitAll:[0,1,2,3,4],\n\n      personasInterventor:[],\n      personasContratista:[],\n      personasResponsable:[],\n\n\n      interventoresSelect:[],\n      contratistasSelect:[],\n      responsablesSelect:[],\n\n      interventor:\"\",\n      contratista:\"\",\n      responsable:\"\",\n\n      start_request_date:\"\",\n      end_request_date:\"\",\n      total_days:\"\",\n\n      causals:[],\n      clauses:[],\n\n\n      causal: \"\",\n      clausulas: \"\",\n      clausulas_request:[],\n      person_charge:\"\",\n      message:\"\",\n      tipo_solicitud:\"\",\n      trabajadores:[],\n      step: this.stp,\n      correct_date: false,\n      modal_show: false,\n      submitting: false\n    }\n  },\n  validations: {\n    tipo_solicitud:{required}, interventor:{required}, contratista:{required},\n    start_request_date:{required}, end_request_date:{required},\n    total_days:{required}, causal:{required}, responsable: {required}\n  },\n  watch:{\n    interventor:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n    contratista:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n    responsable:function(val){\n      this.personasInterventor = this.interventoresSelect.filter(p => p!=this.contratista && p!=this.responsable)\n      this.personasContratista = this.contratistasSelect.filter(p => p!=this.interventor && p!=this.responsable)\n      this.personasResponsable = this.responsablesSelect.filter(p => p!=this.interventor && p!=this.contratista)\n    },\n\n  },\n  methods:{\n\n    async loadDataMultiselects(){\n      this.permitODS=await verifyPermits(9,this.permitAll)\n      this.permitODC=await verifyPermits(10,this.permitAll)\n      this.permitATI=await verifyPermits(11,this.permitAll)\n\n      let causalsData=await requestModulePermit(200,0)\n      let clausesData=await requestModulePermit(6,0)\n      console.log(\"asdadsad\");\n      console.log(this.permitODS[2]);\n      console.log(this.permitODC[2]);\n      console.log(this.permitATI[2]);\n\n      if (!this.permitODS[2] && !this.permitODC[2] && !this.permitATI[2]) {\n        alert(\"no tiene permiso\")\n      }\n      else{\n        if (causalsData !== -1  && causalsData!== 0) {\n          this.causals = causalsData\n        }\n        if (clausesData !== -1 && clausesData !== 0) {\n          this.clauses = clausesData\n        }\n        let types_tmp=await requestModulePermit(205,0)\n        for (var k in types_tmp){\n          if(types_tmp[k].nombre == \"ODS\" && this.permitODS[2]){\n            this.types_request.push(types_tmp[k])\n          }\n          else if(types_tmp[k].nombre == \"ODC\" && this.permitODC[2]){\n            this.types_request.push(types_tmp[k])\n          }\n          else if(types_tmp[k].nombre == \"ATI\" && this.permitATI[2]){\n            this.types_request.push(types_tmp[k])\n          }\n        }\n        let allProfesores = await requestModulePermit(206,0,\"profesor\")\n        let allContratistas = await requestModulePermit(206,0,\"contratista\")\n        let allPlanta = await requestModulePermit(206,0,\"planta\")\n        for (var k in allProfesores){\n          var person = {}\n          person[\"_id\"] = allProfesores[k]._id;\n          person[\"name\"] = allProfesores[k].primer_nombre+\" \"+allProfesores[k].segundo_nombre+\" \"+allProfesores[k].primer_apellido+\" \"+allProfesores[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n        }\n        for (var k in allContratistas){\n          var person = {}\n          person[\"_id\"] = allContratistas[k]._id;\n          person[\"name\"] = allContratistas[k].primer_nombre+\" \"+allContratistas[k].segundo_nombre+\" \"+allContratistas[k].primer_apellido+\" \"+allContratistas[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n          this.contratistasSelect.push(person);\n        }\n        for (var k in allPlanta){\n          var person = {}\n          person[\"_id\"] = allPlanta[k]._id;\n          person[\"name\"] = allPlanta[k].primer_nombre+\" \"+allPlanta[k].segundo_nombre+\" \"+allPlanta[k].primer_apellido+\" \"+allPlanta[k].segundo_apellido;\n          this.interventoresSelect.push(person);\n          this.responsablesSelect.push(person);\n        }\n        this.personasInterventor = this.interventoresSelect\n        this.personasContratista = this.contratistasSelect\n        this.personasResponsable = this.responsablesSelect\n      }\n    },\n\n    changeEndRequestDate(){\n      var sd=new Date(this.start_request_date);\n      var ed=new Date(this.end_request_date);\n      if (sd > ed) {\n        this.correct_date = true\n        this.total_days=0;\n      } else {\n        this.correct_date = false\n        sd.setDate(sd.getDate()+1)\n        ed.setDate(ed.getDate()+1)\n        var differentDays = Math.ceil(Math.abs( ed.getTime() - sd.getTime()) / (1000 * 3600 * 24));\n        this.total_days=differentDays+1;\n      }\n    },\n    cancel(){\n      this.$v.$reset()\n      this.$swal({\n        title: 'Espere',\n        text: '¿Esta seguro que quiere cancelar la operación?',\n        type: 'warning',\n        showCancelButton: true,\n        confirmButtonText: 'Si',\n        cancelButtonText: 'No',\n      }).then((result) => {\n        if (result.value) {\n          this.$swal({\n            title: 'Cancelado',\n            type: 'success'\n          }).then((result) => {\n            if (result.value) {\n              this.$router.push({ name: 'requests' });\n            }\n          });\n        }\n      });\n    },\n    async saveContinue(){\n      this.$v.$touch()\n      if (this.$v.$invalid) {\n        this.$swal({\n          title: 'Error!',\n          text: 'Debe llenar campos necesarios en el formulario',\n          type: 'error',\n          confirmButtonText: 'Cerrar'\n        });\n      } else {\n        this.submitting = true\n        for(var k in this.clausulas){\n          this.clausulas_request.push(this.clausulas[k]._id)\n        }\n\n        let data = {\n          numero_solicitud: \"\",\n          tipo_solicitud:this.tipo_solicitud._id,\n          fecha_inicio:this.start_request_date,\n          fecha_final: this.end_request_date,\n          valor_solicitud:0,\n          justificacion:\"\",\n          justificacion_adicional:\"\",\n          causal_seleccion:this.causal._id,\n          objetivo_general:\"\",\n          clausulas:this.clausulas_request,\n          especificaciones_tecnicas:[],\n          obligaciones_especificas:[],\n          rubros:[],\n          trabajadores:[{persona:this.contratista._id,tipo:\"Contratista\"},{persona:this.interventor._id,tipo:\"Interventor\"},{persona:this.responsable._id,tipo:\"Responsable\"}]\n        }\n\n        let res;\n\n        if (this.tipo_solicitud.nombre == \"ODS\" && this.permitODS[2]) {\n          res=await postModulePermit(9,2,data)\n        }\n        else if (this.tipo_solicitud.nombre == \"ODC\" && this.permitODC[2]) {\n          res=await postModulePermit(10,2,data)\n        }\n        else if (this.tipo_solicitud.nombre == \"ATI\" && this.permitATI[2]) {\n          res=await postModulePermit(11,2,data)\n        }\n\n        if (res != undefined && res != null){\n          if (res.res) {console.log(res.res.obj.data);\n            this.$swal({\n              title: 'Exito!',\n              text: 'Se creo la solicitud con exito.',\n              type: 'success',\n              confirmButtonText: 'Aceptar'\n            }).then((result) => {\n              if (result.value) {\n                this.$emit('saveObject',res);\n                this.submitting = false;\n                this.step++\n                this.$emit('nextStep', this.step)\n              }\n            });\n          }\n          else if (res.error) {\n            this.$swal({\n               title: 'Error!',\n               text: res.error.error.msg,\n               type: 'error',\n               confirmButtonText: 'Cerrar'\n             });\n             this.submitting = false;\n          }\n        }\n\n      }\n    },\n\n    // saveContinue(){\n    //   this.$v.$touch()\n    //   if (this.$v.$invalid) {\n    //     this.$swal({\n    //       title: 'Error!',\n    //       text: 'Debe llenar campos necesarios en el formulario',\n    //       type: 'error',\n    //       confirmButtonText: 'Cerrar'\n    //     });\n    //   } else {\n    //     this.submitting = true\n    //     for(var k in this.clausulas){\n    //       this.clausulas_request.push(this.clausulas[k]._id)\n    //     }\n    //     axios\n    //     .post(API_IP+\"/request\", {\n    //       numero_solicitud: \"\",\n    //       tipo_solicitud:this.tipo_solicitud._id,\n    //       fecha_inicio:this.start_request_date,\n    //       fecha_final: this.end_request_date,\n    //       valor_solicitud:0,\n    //       justificacion:\"\",\n    //       justificacion_adicional:\"\",\n    //       causal_seleccion:this.causal._id,\n    //       objetivo_general:\"\",\n    //       clausulas:this.clausulas_request,\n    //       especificaciones_tecnicas:[],\n    //       obligaciones_especificas:[],\n    //       rubros:[],\n    //       trabajadores:[{persona:this.contratista._id,tipo:\"Contratista\"},{persona:this.interventor._id,tipo:\"Interventor\"},{persona:this.person_charge._id,tipo:\"Responsable\"}]\n    //     })\n    //     .then(response => {\n    //       console.log(response);\n    //       this.$swal({\n    //         title: 'Exito!',\n    //         text: 'Se creo la solicitud con exito.',\n    //         type: 'success',\n    //         confirmButtonText: 'Aceptar'\n    //       }).then((result) => {\n    //         if (result.value) {\n    //           this.$emit('saveObject',response.data);\n    //           this.submitting = false;\n    //           this.step++\n    //           this.$emit('nextStep', this.step)\n    //         }\n    //       });\n    //     })\n    //     .catch(error => {\n    //       console.log(error);\n    //       this.$swal({\n    //         title: 'Error!',\n    //         text: error.response.data.error.msg,\n    //         type: 'error',\n    //         confirmButtonText: 'Cerrar'\n    //       });\n    //       this.submitting = false;\n    //     });\n    //   }\n    // },\n    // // Modal para la creación de personas\n    showModalCreatePerson () {\n      this.modal_show = false;\n      this.$modal.show('create-person');\n    },\n    closeModalCreatePerson (value) {\n      this.modal_show = value;\n      if(this.modal_show === true){\n        this.$modal.hide('create-person');\n        location.reload();\n      }\n    },\n    showModalCreateClause () {\n      this.modal_show = false;\n      this.$modal.show('create-clause');\n    },\n    closeModalCreateClause (value) {\n      this.modal_show = value;\n      if(this.modal_show === true){\n        this.$modal.hide('create-clause');\n        location.reload();\n      }\n    }\n  },\n  mounted(){\n    this.loadDataMultiselects()\n  }\n}\n</script>\n"]}]}